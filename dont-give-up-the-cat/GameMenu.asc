// new module script
#define THEMED_BTN_COUNT 4

struct ThemedButton {
  Button* btn;
  DynamicSprite* NormalSprite;
  DynamicSprite* MouseOverSprite;
  DynamicSprite* PushedSprite;
};

int _themed_btn_count;
ThemedButton _themed_btn[THEMED_BTN_COUNT];

void menu_btn_click_resume()
{
  gGameMenu.Visible = false;
}

void menu_btn_click_save()
{
  
}

void menu_btn_click_exit_to_menu()
{
  
}

void menu_btn_click_quit()
{
  QuitGame(1);
}

void Menu_btn_any_OnClick(GUIControl *control, MouseButton button)
{
  if(control == btn_menu_quit) {
    menu_btn_click_quit();
  } else if(control == btn_menu_resume) {
    menu_btn_click_resume();
  } else if(control == btn_menu_exit_to_menu) {
    menu_btn_click_exit_to_menu();
  } else if(control == btn_menu_save) {
    menu_btn_click_save();
  }
}

void Menu_Toggle()
{  
  bool orig_visibility = gGameMenu.Visible;
  gGameMenu.Visible = !orig_visibility;
}

void _draw_text(DrawingSurface* surf, int text_x, int text_y, int color, int border_color, FontType font, String txt)
{
  surf.DrawingColor = border_color; 
  surf.DrawString(text_x-1, text_y, font, txt);
  surf.DrawString(text_x+1, text_y, font, txt);
  surf.DrawString(text_x, text_y-1, font, txt);
  surf.DrawString(text_x, text_y+1, font, txt);
    
  surf.DrawingColor = color;
  
  surf.DrawString(text_x, text_y, font, txt);  
}

void _theme_menu_btn(Button* btn)
{
  FontType font = eFontMenu;
  String txt = btn.Text;
  int btn_w = btn.Width;
  int btn_h = btn.Height;
  btn.Text = "";
  int text_x = (btn_w - GetTextWidth(txt, font))/2;
  int text_y = (btn_h - GetTextHeight(txt, font, btn_w))/2;
  
  DrawingSurface* surf;
  DynamicSprite* spr_n = DynamicSprite.Create(btn_w, btn_h, true);
  DynamicSprite* spr_p = DynamicSprite.Create(btn_w, btn_h, true);
  DynamicSprite* spr_o = DynamicSprite.Create(btn_w, btn_h, true);
 
  _draw_text(spr_n.GetDrawingSurface(), text_x, text_y, 58801, 8457, font, txt);
  _draw_text(spr_p.GetDrawingSurface(), text_x+1, text_y+1, 58801, 12715, font, txt);
  _draw_text(spr_o.GetDrawingSurface(), text_x, text_y, 52106, 8457, font, txt);
 
  btn.NormalGraphic = spr_n.Graphic;
  btn.MouseOverGraphic = spr_o.Graphic;
  btn.PushedGraphic = spr_p.Graphic;
  
  _themed_btn[_themed_btn_count].btn = btn;
  _themed_btn[_themed_btn_count].NormalSprite = spr_n;
  _themed_btn[_themed_btn_count].MouseOverSprite = spr_o;
  _themed_btn[_themed_btn_count].PushedSprite = spr_p;
  _themed_btn_count++; 
}

void game_start()
{
  _theme_menu_btn(btn_menu_exit_to_menu);
  _theme_menu_btn(btn_menu_quit);
  _theme_menu_btn(btn_menu_resume);
  _theme_menu_btn(btn_menu_save);
}